import{r as p,a as A}from"./react-ppAWL3zK.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))d(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&d(r)}).observe(document,{childList:!0,subtree:!0});function n(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?s.credentials="include":e.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function d(e){if(e.ep)return;e.ep=!0;const s=n(e);fetch(e.href,s)}})();var k={exports:{}},x={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var D=p,T=Symbol.for("react.element"),L=Symbol.for("react.fragment"),N=Object.prototype.hasOwnProperty,q=D.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,B={key:!0,ref:!0,__self:!0,__source:!0};function w(u,o,n){var d,e={},s=null,r=null;n!==void 0&&(s=""+n),o.key!==void 0&&(s=""+o.key),o.ref!==void 0&&(r=o.ref);for(d in o)N.call(o,d)&&!B.hasOwnProperty(d)&&(e[d]=o[d]);if(u&&u.defaultProps)for(d in o=u.defaultProps,o)e[d]===void 0&&(e[d]=o[d]);return{$$typeof:T,type:u,key:s,ref:r,props:e,_owner:q.current}}x.Fragment=L;x.jsx=w;x.jsxs=w;k.exports=x;var t=k.exports,R,j=A;R=j.createRoot,j.hydrateRoot;function C(u,o,n){const d=u.replace(/^http/,"ws")+`/rtc/room/${encodeURIComponent(o)}`,e=new WebSocket(d);return e.onmessage=s=>{try{n(JSON.parse(s.data))}catch{}},{send:s=>e.readyState===e.OPEN&&e.send(JSON.stringify(s)),close:()=>e.close()}}function M(u){function o(n){const d=[n.ctrlKey?"Ctrl":"",n.altKey?"Alt":"",n.shiftKey?"Shift":"",n.key.length===1?n.key.toUpperCase():n.key].filter(Boolean).join("+"),e=u[d];e&&(n.preventDefault(),e(n))}return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)}function U({apiBase:u,roomId:o,me:n,isHost:d}){const[e,s]=p.useState([]),[r,y]=p.useState(null),f=p.useRef(null);p.useEffect(()=>{const a=C(u,o,l=>{l.type==="state"?s(c=>l.users.map(i=>{const g=c.find(P=>P.userId===i.userId);return{...i,mutedA:g?.mutedA,mutedV:g?.mutedV}})):l.type==="role"?s(c=>c.map(i=>i.userId===l.userId?{...i,role:l.role}:i)):l.type==="mute"?s(c=>c.map(i=>i.userId===l.userId?{...i,[l.kind==="audio"?"mutedA":"mutedV"]:l.value}:i)):l.type==="join"&&s(c=>c.some(i=>i.userId===l.userId)?c:[...c,{...l,role:"queue"}])});return f.current=a,setTimeout(()=>a.send({type:"join",...n}),100),()=>a.close()},[u,o,n.userId]);function m(a,l){d&&f.current?.send({type:"role",userId:a,role:l})}function h(a,l){if(!d&&a!==n.userId)return;const c=e.find(g=>g.userId===a),i=l==="audio"?!c?.mutedA:!c?.mutedV;f.current?.send({type:"mute",userId:a,kind:l,value:!!i})}p.useEffect(()=>M({"Ctrl+1":()=>r&&m(r,"backstage"),"Ctrl+2":()=>r&&m(r,"onair"),"Ctrl+0":()=>r&&m(r,"queue"),M:()=>r&&h(r,"audio")}),[r,d,e]);function O(a){a.preventDefault()}function _(a){return l=>{l.dataTransfer.setData("text/plain",a)}}function E(a){return l=>{l.preventDefault();const c=l.dataTransfer.getData("text/plain");c&&m(c,a)}}const b=p.useMemo(()=>({queue:e.filter(a=>a.role==="queue"),backstage:e.filter(a=>a.role==="backstage"),onair:e.filter(a=>a.role==="onair")}),[e]);function v(a,l,c){return t.jsxs("div",{onDragOver:O,onDrop:E(l),style:{border:"1px solid #23262e",borderRadius:12,padding:8},children:[t.jsx("div",{style:{fontSize:12,opacity:.7,marginBottom:6},children:a}),t.jsxs("div",{style:{display:"grid",gap:6},children:[c.map(i=>t.jsxs("div",{draggable:!0,onDragStart:_(i.userId),onClick:()=>y(i.userId),style:{padding:"8px 10px",borderRadius:10,border:"1px solid "+(r===i.userId?"#7785ff":"#23262e"),background:r===i.userId?"#151a2b":"#0b0c10",display:"flex",gap:8,alignItems:"center",justifyContent:"space-between",cursor:"grab"},children:[t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[t.jsx("div",{style:{width:8,height:8,borderRadius:99,background:i.role==="onair"?"#22c55e":i.role==="backstage"?"#eab308":"#64748b"}}),t.jsx("div",{children:i.name})]}),t.jsxs("div",{style:{display:"flex",gap:6},children:[t.jsx("button",{onClick:g=>{g.stopPropagation(),h(i.userId,"audio")},title:"Toggle mic",style:I,children:i.mutedA?"ğŸ”‡":"ğŸ™ï¸"}),t.jsx("button",{onClick:g=>{g.stopPropagation(),h(i.userId,"video")},title:"Toggle cam",style:I,children:i.mutedV?"ğŸš«ğŸ“·":"ğŸ“·"})]})]},i.userId)),!c.length&&t.jsx("div",{style:{opacity:.5,fontSize:12},children:"Drop here"})]})]})}return t.jsxs("aside",{style:{width:320,borderLeft:"1px solid #23262e",padding:12,display:"grid",gap:10},children:[t.jsx("div",{style:{fontWeight:700},children:"People"}),v("Queue","queue",b.queue),v("Backstage","backstage",b.backstage),v("On-Air","onair",b.onair),t.jsx("div",{style:{fontSize:12,opacity:.7},children:"Tips: drag to move Â· Ctrl+1 â†’ backstage Â· Ctrl+2 â†’ on-air Â· Ctrl+0 â†’ queue Â· M â†’ mute."})]})}const I={padding:"4px 8px",borderRadius:8,border:"1px solid #334155",background:"#1f2937",color:"#e7ebf0"};function V({tiles:u}){const o=u.filter(n=>n.role==="onair");return t.jsxs("div",{style:{border:"1px solid #23262e",borderRadius:16,padding:12,minHeight:260},children:[t.jsx("div",{style:{fontWeight:700,marginBottom:8},children:"On-Air"}),o.length===0?t.jsx("div",{style:{opacity:.6,fontSize:13},children:"Nobody on-air yet."}):t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(220px,1fr))",gap:12},children:o.map(n=>t.jsxs("div",{style:{border:"1px solid #23262e",borderRadius:12,padding:10,background:"#0b0c10",display:"grid",gap:6},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx("b",{children:n.name}),t.jsxs("div",{children:[n.mutedA?"ğŸ”‡":"ğŸ™ï¸"," ",n.mutedV?"ğŸš«ğŸ“·":"ğŸ“·"]})]}),t.jsx("div",{style:{background:"#111318",border:"1px solid #23262e",borderRadius:10,height:120,display:"grid",placeItems:"center",opacity:.5},children:"video feed"})]},n.userId))})]})}const S=typeof window<"u"&&window.MUTINY_API_BASE||"https://mutiny-api.mutinycomm.workers.dev";function z(){const[u]=p.useState("main"),[o]=p.useState({userId:crypto.randomUUID(),name:"You"}),[n,d]=p.useState([]),[e]=p.useState(!0);return p.useEffect(()=>{document.title="Mutiny Communicator"},[]),p.useEffect(()=>{const s=C(S,u,r=>{r.type==="state"&&d(r.users),r.type==="role"&&d(y=>y.map(f=>f.userId===r.userId?{...f,role:r.role}:f)),r.type==="mute"&&d(y=>y.map(f=>f.userId===r.userId?{...f,[r.kind==="audio"?"mutedA":"mutedV"]:r.value}:f)),r.type==="join"&&d(y=>y.some(f=>f.userId===r.userId)?y:[...y,{...r,role:"queue"}])});return setTimeout(()=>s.send({type:"join",...o}),100),()=>s.close()},[u,o.userId]),t.jsxs("div",{style:{display:"grid",gridTemplateRows:"auto 1fr",height:"100vh",background:"#0b0c10",color:"#e7ebf0"},children:[t.jsxs("header",{style:{display:"flex",alignItems:"center",gap:12,padding:"10px 16px",borderBottom:"1px solid #23262e"},children:[t.jsx("b",{children:"Mutiny Communicator"}),t.jsxs("div",{style:{marginLeft:"auto",opacity:.7,fontSize:12},children:["Room: ",u]})]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 320px"},children:[t.jsx("main",{style:{padding:12,overflow:"auto"},children:t.jsx(V,{tiles:n})}),t.jsx(U,{apiBase:S,roomId:u,me:o,isHost:e})]})]})}R(document.getElementById("root")).render(t.jsx(z,{}));
